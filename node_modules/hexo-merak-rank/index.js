const logger = require('hexo-log');
log = logger(this.env);
var request = require('sync-request');

hexo.extend.filter.register('before_generate', function () {
    log.info("Merak Rank by Kevin Li");
});

hexo.extend.tag.register('merak_rank', function (args) {
    let result = '';
    var res = request('GET', 'https://buuoj.cn/plugins/new-challenges/affiliation_daily?affiliation=Merak&t=' + Date.now());
    if (res.statusCode == 200) {
        let str = JSON.parse(res.getBody().toString());
        str.total = str.data.length;
        result += `<table id="table" border="1" cellspacing="0" cellpadding="0" >
    <tr>
    <th>七天内是否做题</th>
    <th>七天内做题个数</th>
    <th>上一次做题分数</th>
    <th>七天内总分</th>
    <th>ID</th>
    </tr>`;
        for (var i = 0; i < str.data.length; i++) {
            result += '<tr>';
            for (var key in str.data[i]) {
                result = result + '<th>' + str.data[i][key] + '</th>';
            }
            result += '</tr>';
        }
        result += '</table>';
    }
    return result;
}, { async: false });